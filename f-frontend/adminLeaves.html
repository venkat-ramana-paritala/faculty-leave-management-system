<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaves</title>
    <style>
       body{
            height: 100vh;
            display: flex;
            align-items: center;
            flex-direction: column;
            font-family: sans-serif;
            background-color: transparent;
        }
        .table {
               width: 90%;               
               margin: 60px auto;        
               border-collapse: collapse;
               background-color: white;  
               border-radius: 10px;      
               overflow: hidden;         
               box-shadow: 0 6px 8px rgba(0,0,0,0.1); 
               font-family: sans-serif;
               }


               .table th, .table td {
                padding: 25px;            
                text-align: left;         
                border-bottom: 1px solid #ddd; 
                font-size: large;
                }

               .table-title {
                background-color: rgb(122, 27, 211); 
                color: white;
                text-align: center !important; 
                font-size: 28px;
                text-transform: uppercase;
                letter-spacing: 1px;
                }

                .col-headers th {
                 background-color: rgb(217, 229, 237); 
                 color: rgb(19, 64, 67);
                 font-size: 22px;
                  }

                .err-message { color: red; }
    </style>
</head>
<body>
    <h1>Leave records</h1>
    <table class="table" id="historyTable">
        <thead>
            <tr>
               <th colspan="6" class="table-title">Leaves</th>
            </tr>
            <tr class="col-headers">
                <th>Faculty code</th>
                <th>Department</th>
                <th>Status</th>
               <th>From</th>
               <th>To</th>
               <th>Type</th>
            </tr>
        </thead>
        <tbody class="tbody" id="tbody">
            <tr>
                <td colspan="4">Loading the leave records...</td>
            </tr>
        </tbody>
    </table>
    <p id="message" class="err-message"></p>
    <script>
        window.onload = async ()=>{
           fetchLeaves();
        }
        async function fetchLeaves() {
            try{
                const response = await fetch("http://localhost:4000/admin/leaves",{
                    method :"GET",
                    credentials :"include"
                });
                const tableBody = document.getElementById("tbody");
                const message = document.getElementById("message");
                if(response.status===401||response.status===403){
                    message.textContent="You are not logged in";
                    tableBody.innerHTML = "";
                    return;
                }
                if(response.status===404){
                    tableBody.innerHTML = "<tr><td colspan='6'>No Leave records found</td></tr>"
                    return;
                }
                const Leaves = await response.json();
                tableBody.innerHTML="";
                Leaves.forEach(l=>{
                    let color = "black";
                        if(l.status==='Pending'){
                            color='orange';
                        }
                        else if(l.status==='Approved'){
                            color='green';
                        }
                        else if(l.status==='Rejected'){
                            color='red';
                        }
                    const row = `
                    <tr>
                        <td>${l.faculty_code}</td>
                        <td>${l.department}</td>
                        <td style="color: ${color};font-weight:bold">${l.status}</td>
                        <td>${l.from}</td>
                        <td>${l.to}</td>
                        <td>${l.type}</td>
                    </tr>
                    `;
                    tableBody.innerHTML+=row;
                });
                
            }
            catch(err){
                console.error("Error : "+err);
                document.getElementById("message").textContent="Failed to load leave record";
            }
        }
        fetchLeaves()
    </script>
</body>
</html>